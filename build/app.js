/*! anonymity 21-11-2016 */
process.env.NODE_ENV="production",process.env.PORT=80;var express=require("express"),mongoose=require("mongoose"),xml2js=require("xml2js"),parser=new xml2js.Parser,bodyParser=require("body-parser"),wordFilter=require("./wordFilter.js"),app=express();app.use(express.static(__dirname+"/public/"));var port=process.env.PORT||3e3;console.log("Express server running on "+port),app.listen(process.env.PORT||port),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0}));var wordsSchema=mongoose.Schema({words:String,color:String,weight:String}),WordsModel=mongoose.model("words_model",wordsSchema),db=mongoose.connection;db.on("error",console.error),mongoose.connect("mongodb://localhost/anoymity_speech"),db.once("open",function(){app.post("/words",function(a,b,c){var d=a.body.words,e=wordFilter.Filtering(d),f=new WordsModel({words:e,color:a.body.color,weight:a.body.weight}),g=e.split(" ").length,h=e.split("").length;g<=101&&h<=1001&&(f.save(function(a,b){if(a)throw console.err(a),a}),b.send(f))}),app.get("/all",function(a,b,c){WordsModel.find().skip(parseInt(a.query.skip)).limit(parseInt(a.query.limit)).exec(function(a,c){if(a)throw console.log(a),a;b.send(c)})})});