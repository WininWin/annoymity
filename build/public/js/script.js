/*! anonymity 09-12-2016 */
function setCookie(a,b,c){var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3);var e="expires="+d.toUTCString();document.cookie=a+"="+b+";"+e+";path=/"}function getCookie(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}function wordCount(a){return a=a.trim(),word_array=a.replace(/\r?\n|\r/g," "),word_array=word_array.replace(/\s\s+/g," "),word_array=word_array.split(" "),word_array.length}function getRandomPositionTop(){var a=$("#main").offset().top,b=a+$("#main").height(),c=Math.random()*a,d=b+Math.random()*($(document.body).height()-b),e=Math.random();return e<.5?c:d}function getRandomPositionLeft(){var a=$("#main").offset().left,b=a+$("#main").width(),c=Math.random()*a,d=b+Math.random()*($(document.body).width()-b),e=Math.random();return e<.5?c:d}function draw(a){d3_layer.selectAll("text").data(a,function(a){return a}).enter().append("text").style("font-size",function(a){return a.size+"px"}).style("font-family","Impact").style("fill",function(a,b){return fill(b)}).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.text})}function update(a){var b=d3_layer.selectAll("text").data(a,function(a){return a});b.transition().duration(500).on("start",function(){d3.select(this)}).delay(function(b,c){return c/a.length*500}).on("end",function(){d3.select(this).transition().duration(500).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.text})}).style("font-size",function(a){return a.size>60&&(a.size=60),a.size+"px"}).style("font-family","Impact").style("fill",function(a,b){return fill(b)}),b.enter().append("text").transition().duration(500).on("start",function(){d3.select(this)}).delay(function(b,c){return c/a.length*500}).on("end",function(){d3.select(this).transition().duration(500).attr("text-anchor","middle").attr("transform",function(a){return"translate("+[a.x,a.y]+")rotate("+a.rotate+")"}).text(function(a){return a.text})}).style("font-size",function(a){return a.size>60&&(a.size=60),a.size+"px"}).style("font-family","Impact").style("fill",function(a,b){return fill(b)}),b.exit().remove()}var timesSubmitted=0,interval,skip=0,init_words=[],layout,d3_layer,fill;$(document).ready(function(){$("#loading").hide(),$("#main").hide();var a=io();a.on("refresh feed",function(a){var b=getRandomPositionTop(),c=getRandomPositionLeft(),d=$("<div />").addClass("row pop-up-box").css({left:c,top:b});d.append("<div class='col-md-12'>"+a+"</div>"),$(document.body).append(d),d.hide().fadeIn("slow"),d.delay("2500").fadeOut("slow"),$.get("/count",function(a){$("#Total").text("Total Count : "+a)}),setTimeout(function(){d.remove()},3e3)}),a.on("refresh d3",function(a){"done"===a&&$.get("/all",function(a){init_words=a,layout.words(init_words.map(function(a){return{text:a.word,size:a.size}})).padding(5).rotate(function(){return 90*~~(2*Math.random())}).font("Impact").fontSize(function(a){return a.size}).on("end",update),layout.start(),timesSubmitted<6&&($("#submit").show(),$("#loading").hide())})}),$("#input_box").on("input",function(){var a=wordCount($("#input_box").val()),b=$("#input_box").val().split("").length;$("#wordcount").text("Word Count : "+a),$("#chara_count").text("Character Count : "+b),""===$("#input_box").val()&&$("#wordcount").text("Word Count : 0"),a>30?$("#input_box").keypress(function(a){a.preventDefault()}):$("#input_box").off("keypress")}),$.get("/all",function(a){init_words=a,layout=d3.layout.cloud().size([window.innerWidth,window.innerHeight]),d3_layer=d3.select("body").append("svg").attr("width",layout.size()[0]).attr("height",layout.size()[1]).append("g").attr("transform","translate("+layout.size()[0]/2+","+layout.size()[1]/2+")"),fill=d3.scaleOrdinal(d3.schemeCategory20),layout.words(init_words.map(function(a){return{text:a.word,size:a.size}})).padding(5).rotate(function(){return 90*~~(2*Math.random())}).font("Impact").fontSize(function(a){return a.size}).on("end",draw),layout.start(),$("#doc_loading").hide(),$("#main").fadeIn()}),$.get("/count",function(a){$("#Total").text("Total Count : "+a)}),$("#comment").submit(function(a){$("#submit").hide(),$("#loading").show();var b=getCookie("toomanyattempts");if(""!==b&&"NaN"!==b&&(timesSubmitted=parseInt(b)),interval||(interval=setTimeout(function(){interval=void 0,timesSubmitted=0,setCookie("toomanyattempts","0",1),$("#loading").hide(),$("#submit").show()},6e4)),timesSubmitted+=1,setCookie("toomanyattempts",timesSubmitted,1),timesSubmitted>5)$("#error_msg").text("Too many submit attempts!!").fadeIn("slow").delay("2000").fadeOut("slow"),a.preventDefault();else{var c=wordCount($("#input_box").val()),d=$("#input_box").val().split("").length;(c>30||d>150)&&($("#error_msg").text("You exceed 30 words or 150 characters"),a.preventDefault()),$(this).ajaxSubmit({error:function(a){console.log(a.status)},success:function(a){}}),a.preventDefault()}})});